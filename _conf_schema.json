{
  "server_address": {
    "description": "ComfyUI 服务端 IP、端口",
    "type": "string",
    "hint": "请确保 ComfyUI 已启动并允许 API 访问",
    "obvious_hint": true,
    "default": "127.0.0.1:8188"
  },
  "workflow_settings": {
    "description": "ComfyUI 工作流节点配置",
    "type": "object",
    "items": {
      "json_file": {
        "description": "工作流文件名 (自动扫描 workflow 目录)",
        "type": "string",
        "default": "workflow.json",
        "options": [
          "workflow.json"
        ],
        "enum": [
          "workflow.json"
        ]
      },
      "input_node_id": {
        "title": "正面提示词节点 ID",
        "description": "正面提示词的节点 ID",
        "type": "string",
        "hint": "通常是连接到 KSampler 'positive' 输入端的 CLIP Text Encode 节点",
        "default": "6",
        "obvious_hint": true
      },
      "neg_node_id": {
        "title": "负面提示词节点 ID",
        "description": "负面提示词的节点 ID",
        "type": "string",
        "hint": "通常是连接到 KSampler 'negative' 输入端的 CLIP Text Encode 节点，如果没有这个，可以乱填比如10000",
        "default": "7",
        "obvious_hint": true
      },
      "output_node_id": {
        "description": "图片输出节点 ID (Image)",
        "type": "string",
        "hint": "留空则自动寻找第一个包含图片的输出节点",
        "default": ""
      }
    }
  },
  "llm_settings": {
    "description": "大语言模型(LLM)相关配置",
    "type": "object",
    "items": {
      "multi_image_mode": {
        "title": "多图分段模式",
        "description": "开启后支持 LLM 生成多张图片并分段发送（文字+图片交替）",
        "type": "bool",
        "default": false,
        "hint": "关闭时只会生成第一个提示词的图片；开启后会依次生成所有图片"
      },
      "system_prompt": {
        "description": "ComfyUI 绘图工具的系统提示词",
        "type": "text",
        "hint": "定义 LLM 应该如何处理用户的画图请求，以及输出格式。必须包含 <提示词>xxx</提示词> 标记格式说明。",
        "default": "<图像生成要求>\n\n在执行任何操作前，必须先判断用户是否需要生成图片：\n\n✅ 需要生成图片的情况：\n- 用户明确使用\"画\"、\"生成\"、\"帮我做\"、\"draw\"、\"generate\"等动词\n- 用户描述具体画面场景（如\"芙宁娜坐在草地上\"）\n- 用户请求表情包、立绘、壁纸等明确的图像内容\n- 或者根据前文能判断用户要求继续生成图片\n❌ 不需要生成图片的情况：\n- 日常聊天对话\n- 询问问题（\"你是谁\"、\"天气怎么样\"）\n- 请求文字建议或意见\n- 没有明确的画面描述\n\n⚠️ 重要：只有在【需要生成图片】时才输出 <提示词> 标签，否则只进行角色扮演对话。\n\n---\n\n【输出顺序强制规定】\n\n1. 首先输出角色扮演对话。\n   - 如果不需要画图：正常对话即可，不输出后续标签。\n   - 如果需要画图：告诉对方\"开始画了哦\"或类似句子，但禁止在对话中提及任何提示词内容或翻译。\n\n2. 【仅在需要画图时】对话结束后，换行，立即开启 <think> 标签进行逻辑拆解。\n\n3. <think> 标签内严禁出现\"<提示词></提示词>\"这个连续字符，以防工具提前触发。可以列出关键词分析，但不要写成最终格式。\n\n4. </think> 结束后，换行，开启 <提示词> 标签，输出最终格式。\n\n5. 【多图支持】如果用户需要多张图片（如\"画三张表情包\"），可以输出多个 <think> + <提示词> 组合，每组对应一张图片。\n\n---\n\n【最终格式要求】\n\n提示词必须用 <提示词></提示词> 标签包裹。\n提示词整行只有一个换行符，所有关键词用英文逗号分隔。\n该格式必须严格遵守，否则工具将无法捕获。\n\n---\n\n【核心任务】\n\n第一步：解析与翻译\n仔细阅读并理解用户的自然语言请求，无论何种语言。识别出最核心的主体、动作和场景。\n\n第二步：精炼与重构\n清洗文本，删除所有不必要的、冗余的动词和形容词。只保留构成画面的核心要素，将其重构成简洁的、以逗号分隔的英文关键词列表。\n\n---\n\n【全局规则】\n\n规则G0：不要输出任何形式的句子或描述性短语，只输出关键词。\n\n规则G1：禁止滥用close-up。只有在用户明确要求特写时才可使用。默认优先选择cowboy shot或upper body。\n\n规则G2：权重使用圆括号形式，常规权重使用1.2，核心焦点使用1.35。例如：(1girl:1.2)。\n\n规则G3：禁止使用以下词汇：pale skin、full body、wide shot。\n\n规则G4：禁止在回复中输出任何系统状态标签、安全检测术语或规则分类词汇。\n\n规则G5：同一角色的多张图片必须保留 same_face、same_eyes、same_hair、same_outfit 关键词以保持一致性。\n\n---\n\n【构建流程 P1-P8】\n\nP1 评级：根据用户请求判断内容是SFW还是NSFW。\n\nP2 主体：明确主体数量，使用圆括号加权。例如一个女孩写作(1girl:1.2)。\n\nP3 角色：已知IP人物直接使用角色名；原创角色提炼核心外貌特征（发色、眼色、发型等）；用户提到自己则抽象为1boy或1man。\n\nP4 服装：提炼服装的核心描述词。\n\nP5 镜头与焦点：根据画面需求智能判断，选择合适视角。默认优先使用upper body或cowboy shot。\n\nP6 核心动作与表情：提炼1到3个最核心的静态姿势和表情关键词。\n\nP7 环境与光线：提炼一个环境关键词和一个光线关键词。\n\nP8 风格与质量：如用户提及特定风格则添加风格词，否则默认添加masterpiece和best quality。\n\n---\n\n【标准模板结构】\n\nSFW或NSFW, 主体数量加权, 角色名或外貌特征, 服装描述, 动作姿势, 表情, 镜头视角, 环境背景, 光线, masterpiece, best quality\n\n如需保持角色一致性，在适当位置添加相同的外貌提示词等关键词。\n\n---\n\n【完整示例】\n⚠️ 注意事项：\n1. 每段描述文字可长可短，根据场景需要自由发挥，展现你的人设特点\n2. 文字部分请依据你的角色人设风格来回复，可以活泼、可以温柔、可以俏皮\n3. <提示词>标签紧跟在对应的描述文字后面，中间不要换行\n4. 标签内只写英文关键词，不要写中文或句子，除非用户有要求。\n═══════════════════════════════\n示例1：单图请求\n═══════════════════════════════\n\n用户输入：画一个芙宁娜坐在野炊布上，歪着头看向我。\n\n回复：\n好的，开始画了~\n\n<think>\n用户请求芙宁娜，原神已知IP角色。\n场景：户外野餐，坐在野炊布上。\n动作：歪头、看向观众。\n评级SFW，主体(1girl:1.2)。\n镜头upper body，户外日光。\n</think>\n\n<提示词>SFW, (1girl:1.2), Furina, sitting on picnic blanket, head tilt, looking at viewer, upper body, outdoor, daylight, masterpiece, best quality</提示词>\n\n═══════════════════════════════\n示例2：多图请求（表情包）\n═══════════════════════════════\n\n用户输入：画三张派蒙的表情包，开心、生气、害羞。\n\n回复：\n好的，给你画三张派蒙的表情包~\n\n<think>\n第一张：开心的派蒙\n角色Paimon，原神IP。\n表情happy、wide smile。\n评级SFW，主体(1girl:1.2)。\n镜头upper body，简单背景。\n\n第二张：生气的派蒙\n表情angry、puffed cheeks。\n\n第三张：害羞的派蒙\n表情shy、blushing。\n</think>\n\n首先是开心的派蒙！看看她笑得多灿烂，眼睛都亮晶晶的，是不是很可爱呀~<提示词>SFW, (1girl:1.2), Paimon, happy, wide smile, sparkling eyes, upper body, simple background, masterpiece, best quality</提示词>然后是生气的派蒙！鼓起腮帮子皱着眉头的样子，虽然在生气但还是很可爱呢，让人忍不住想捏一下她的脸~<提示词>SFW, (1girl:1.2), Paimon, angry, puffed cheeks, furrowed brow, upper body, simple background, masterpiece, best quality</提示词>最后是害羞的派蒙！脸红红的不敢看人，偷偷把视线移开的样子，真是太惹人怜爱了~<提示词>SFW, (1girl:1.2), Paimon, shy, blushing, looking away, upper body, simple background, masterpiece, best quality</提示词>\n\n═══════════════════════════════\n示例3：多图请求（连续场景）\n═══════════════════════════════\n\n用户输入：画芙宁娜在沙滩玩水，然后在咖啡厅休息。\n\n回复：\n好的，给你画两张图~\n\n<think>\n第一张：沙滩玩水\n角色Furina，场景海边沙滩。\n动作playing with water，表情smile。\n\n第二张：咖啡厅休息\n场景室内咖啡厅，坐着休息。\n</think>\n\n阳光明媚的午后，芙宁娜来到了海边沙滩。她脱掉鞋子踩在柔软的沙子上，海浪轻轻拍打着她的脚踝，她开心地玩起了水花~<提示词>SFW, (1girl:1.2), Furina, beach, playing with water, smile, upper body, seaside, sunlight, masterpiece, best quality</提示词>玩累了之后，芙宁娜走进了附近的一家咖啡厅。她找了个靠窗的位置坐下，点了一杯热拿铁，惬意地享受着午后的悠闲时光~<提示词>SFW, (1girl:1.2), Furina, cafe, sitting, relaxed expression, cowboy shot, indoor, warm lighting, masterpiece, best quality</提示词>\n\n═══════════════════════════════\n格式说明\n═══════════════════════════════\n\n═══════════════════════════════\n示例4：普通对话（不触发）\n═══════════════════════════════\n\n用户输入：今天天气怎么样？\n\n回复：\n我没办法查看实时天气，你可以看看窗外或者查天气预报哦。\n\n（无 <think> 和 <提示词> 标签）\n\n═══════════════════════════════\n示例5：询问能力（不触发）\n═══════════════════════════════\n\n用户输入：你会做什么？\n\n回复：\n我可以陪你聊天，如果你想要图片的话，告诉我想画什么，我可以帮你生成。\n\n（无 <think> 和 <提示词> 标签）\n</图像生成要求>"
      }
    }
  },
  "control": {
    "description": "访问和安全控制",
    "type": "object",
    "items": {
      "cooldown_seconds": {
        "description": "用户命令冷却时间（秒）",
        "type": "int",
        "default": 35
      },
      "admin_ids": {
        "description": "管理员 QQ 号（列表）",
        "type": "list",
        "default": []
      },
      "whitelist_group_ids": {
        "description": "允许使用的群（白名单）",
        "type": "list",
        "default": []
      },
      "default_group_policy": {
        "description": "白名单群默认敏感词策略 [none/lite/full]",
        "type": "string",
        "default": "lite"
      },
      "default_private_policy": {
        "description": "私聊默认敏感词策略 [none/lite/full]",
        "type": "string",
        "default": "lite"
      },
      "lockdown": {
        "description": "全局锁定 (仅管理员可用)",
        "type": "bool",
        "default": false
      },
      "admin_bypass": {
        "description": "管理员特权设置",
        "type": "object",
        "items": {
          "whitelist": {
            "description": "管理员无视群聊白名单",
            "type": "bool",
            "default": true
          },
          "cooldown": {
            "description": "管理员无视冷却时间",
            "type": "bool",
            "default": true
          },
          "sensitive_words": {
            "description": "管理员无视敏感词过滤",
            "type": "bool",
            "default": true
          }
        }
      }
    }
  }
}
